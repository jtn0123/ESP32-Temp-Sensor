<!DOCTYPE html>
<html>
<head>
    <title>Error Detection Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        #log { background: #000; color: #0f0; padding: 10px; height: 400px; overflow-y: auto; white-space: pre; }
        .error { color: #f00; font-weight: bold; }
    </style>
</head>
<body>
    <h1>sim.js Error Detection</h1>
    <div id="log"></div>
    
    <script>
        const logEl = document.getElementById('log');
        
        function log(msg, isError = false) {
            const entry = document.createElement('div');
            entry.textContent = msg;
            if (isError) entry.className = 'error';
            logEl.appendChild(entry);
            console.log(msg);
        }
        
        // Capture all errors
        window.addEventListener('error', function(e) {
            log(`ERROR: ${e.message}`, true);
            log(`  File: ${e.filename}`, true);
            log(`  Line: ${e.lineno}, Column: ${e.colno}`, true);
            log(`  Stack: ${e.error ? e.error.stack : 'N/A'}`, true);
            return true;
        });
        
        // Override console.error
        const originalError = console.error;
        console.error = function(...args) {
            log('Console Error: ' + args.join(' '), true);
            originalError.apply(console, args);
        };
        
        log('Loading sim.js...');
        
        const script = document.createElement('script');
        script.src = 'sim.js';
        
        script.onload = function() {
            log('[OK] sim.js loaded (onload fired)');
            
            // Check what's available
            log('\nChecking window properties:');
            log('  window.draw: ' + typeof window.draw);
            log('  window.drawFromSpec: ' + typeof window.drawFromSpec);
            log('  window.DEFAULTS: ' + typeof window.DEFAULTS);
            log('  window.UI_SPEC: ' + typeof window.UI_SPEC);
        };
        
        script.onerror = function(e) {
            log('[FAIL] sim.js failed to load (onerror fired)', true);
        };
        
        document.head.appendChild(script);
        
        // Also try loading ui_generated.js first
        const uiScript = document.createElement('script');
        uiScript.src = 'ui_generated.js';
        uiScript.onload = () => log('[OK] ui_generated.js loaded');
        uiScript.onerror = () => log('[FAIL] ui_generated.js failed', true);
        document.head.appendChild(uiScript);
    </script>
</body>
</html>