<!DOCTYPE html>
<html>
<head>
    <title>OUT_ROW Debug Test</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px;
            background: #f0f0f0;
        }
        #canvas { 
            border: 2px solid #333;
            background: white;
            display: block;
            margin: 20px 0;
            image-rendering: pixelated;
            transform: scale(2);
            transform-origin: top left;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            padding: 5px 10px;
            margin-right: 10px;
            cursor: pointer;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>OUT_ROW Debug - Finding Thick Border Issue</h1>
    
    <canvas id="canvas" width="250" height="122"></canvas>
    
    <div class="controls">
        <button id="showData">Show Current Data</button>
        <button id="showValidation">Show Validation Issues</button>
        <button id="showRendered">Show Rendered Content</button>
        <button id="toggleValidation">Toggle Validation</button>
        <button id="toggleGeometry">Toggle Geometry</button>
    </div>
    
    <div id="status" class="status">Loading...</div>
    
    <script src="ui_generated.js"></script>
    <script src="sim.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        
        function updateStatus(msg) {
            statusEl.textContent = msg;
        }
        
        // Wait for everything to load
        window.addEventListener('load', () => {
            updateStatus('Simulator loaded. Drawing initial data...');
            
            // Draw with specific data to test OUT_ROW regions
            const testData = {
                room_name: 'Test Room',
                inside_temp_f: 72.5,
                inside_hum_pct: 47,
                outside_temp_f: 68.4,
                outside_hum_pct: 53,
                weather: 'cloudy',
                weather_short: 'cloudy',  // OUT_ROW1_L should show this
                wind_mps: 1.88,  // Will be converted to mph for OUT_ROW2_R
                pressure_hpa: 1013.2,
                battery_percent: 76,
                battery_voltage: 4.01,
                ip: '192.168.1.42',
                fw_version: '1.03'
            };
            
            window.draw(testData);
            
            // Show current data
            document.getElementById('showData').addEventListener('click', () => {
                updateStatus('Current Data:\n' + JSON.stringify(window.lastData, null, 2));
            });
            
            // Show validation issues
            document.getElementById('showValidation').addEventListener('click', () => {
                const issues = window.validationIssues || [];
                const outRowIssues = issues.filter(i => 
                    i.region && (i.region.includes('OUT_ROW') || i.region === 'WEATHER_ICON' || i.region === 'FOOTER_WEATHER')
                );
                
                if (outRowIssues.length === 0) {
                    updateStatus('No validation issues for OUT_ROW regions');
                } else {
                    const issueText = outRowIssues.map(i => 
                        `[${i.severity}] ${i.region}: ${i.type} - ${i.description}`
                    ).join('\n');
                    updateStatus('OUT_ROW Related Issues:\n' + issueText);
                }
                
                // Also show all issues
                if (issues.length > 0) {
                    const allIssuesText = issues.map(i => 
                        `[${i.severity}] ${i.region}: ${i.type} - ${i.description}`
                    ).join('\n');
                    updateStatus('All Validation Issues:\n' + allIssuesText);
                }
            });
            
            // Show rendered content for OUT_ROW regions
            document.getElementById('showRendered').addEventListener('click', () => {
                const rendered = window.renderedContent || {};
                const outRowContent = {};
                
                Object.entries(rendered).forEach(([key, value]) => {
                    if (key.includes('OUT_ROW') || key === 'WEATHER_ICON' || key === 'FOOTER_WEATHER') {
                        outRowContent[key] = value;
                    }
                });
                
                updateStatus('OUT_ROW Rendered Content:\n' + JSON.stringify(outRowContent, null, 2));
            });
            
            // Toggle validation
            document.getElementById('toggleValidation').addEventListener('click', () => {
                const valEl = document.getElementById('validationEnabled');
                if (valEl) {
                    valEl.checked = !valEl.checked;
                    valEl.dispatchEvent(new Event('change'));
                    updateStatus(`Validation ${valEl.checked ? 'enabled' : 'disabled'}`);
                    
                    // Redraw
                    window.draw(testData);
                    
                    // Show issues after redraw
                    setTimeout(() => {
                        document.getElementById('showValidation').click();
                    }, 100);
                }
            });
            
            // Toggle geometry
            document.getElementById('toggleGeometry').addEventListener('click', () => {
                const showRectsEl = document.getElementById('showRects');
                if (showRectsEl) {
                    showRectsEl.checked = !showRectsEl.checked;
                    showRectsEl.dispatchEvent(new Event('change'));
                    updateStatus(`Geometry overlays ${showRectsEl.checked ? 'ON' : 'OFF'}`);
                }
            });
            
            // Initial status
            setTimeout(() => {
                document.getElementById('showValidation').click();
            }, 500);
        });
    </script>
</body>
</html>