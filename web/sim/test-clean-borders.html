<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Clean Borders Test - ESP32 Display Simulator</title>
    <link rel="stylesheet" href="style.css?v=1">
    <style>
        #epd { width: 500px; height: 244px; }
        body { padding: 20px; }
        .controls { margin: 20px 0; }
        .status { 
            margin: 10px 0; 
            padding: 10px; 
            background: #f0f0f0; 
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Clean Borders Test</h1>
    <p>This test verifies that only main region borders are shown, not internal helper rectangles.</p>
    
    <canvas id="epd" width="250" height="122" style="image-rendering: pixelated"></canvas>
    
    <div class="controls">
        <button id="toggleRects">Toggle Region Borders</button>
        <button id="toggleGhosting">Toggle Ghosting</button>
        <button id="testData">Load Test Data</button>
        <label><input type="checkbox" id="showRects"> Show region borders</label>
    </div>
    
    <div class="status" id="status">
        Ready. Internal rectangles (_INNER, _BADGE, LABEL_BOX) should NOT be visible when borders are shown.
    </div>

    <script src="ui_generated.js?v=4"></script>
    <script src="sim.js?v=7"></script>
    <script>
        // Test script
        window.addEventListener('DOMContentLoaded', () => {
            const status = document.getElementById('status');
            const showRectsEl = document.getElementById('showRects');
            
            // Load initial data
            if (window.draw) {
                const testData = {
                    room_name: 'Office',
                    time_hhmm: '10:32',
                    fw_version: '1.03',
                    inside_temp_f: 72.5,
                    inside_hum_pct: 47,
                    outside_temp_f: 68.4,
                    outside_hum_pct: 53,
                    pressure_hpa: 1013.2,
                    weather: 'cloudy',
                    wind_mph: 4.2,
                    battery_percent: 76,
                    battery_voltage: 4.01,
                    ip: '192.168.1.42'
                };
                window.draw(testData);
                status.textContent = 'Loaded test data. Click "Toggle Region Borders" to test.';
            }
            
            document.getElementById('toggleRects').addEventListener('click', () => {
                showRectsEl.checked = !showRectsEl.checked;
                showRectsEl.dispatchEvent(new Event('change'));
                
                if (showRectsEl.checked) {
                    status.innerHTML = '<strong>Borders ON</strong>: You should see borders around main regions only:<br>' +
                        '• HEADER_NAME, HEADER_VERSION, HEADER_TIME_CENTER<br>' +
                        '• INSIDE_TEMP, INSIDE_RH, INSIDE_ROW2<br>' +
                        '• OUT_TEMP, OUT_ROW1_L, OUT_ROW2_L, OUT_ROW2_R<br>' +
                        '• FOOTER_L, FOOTER_WEATHER, WEATHER_ICON<br>' +
                        '<span style="color:red">NOT visible: _INNER, _BADGE, LABEL_BOX rectangles</span>';
                } else {
                    status.textContent = 'Borders OFF. Display should look clean.';
                }
            });
            
            document.getElementById('toggleGhosting').addEventListener('click', () => {
                const ghostEl = document.getElementById('simulateGhosting');
                if (ghostEl) {
                    ghostEl.checked = !ghostEl.checked;
                    ghostEl.dispatchEvent(new Event('change'));
                    status.textContent = `Ghosting ${ghostEl.checked ? 'ON' : 'OFF'}`;
                }
            });
            
            document.getElementById('testData').addEventListener('click', () => {
                if (window.draw) {
                    const extremeData = {
                        room_name: 'Conference Room A',
                        inside_temp_f: 999.9,
                        outside_temp_f: -99.9,
                        pressure_hpa: 1234.5
                    };
                    window.draw(extremeData);
                    status.textContent = 'Loaded extreme data to test overflow.';
                }
            });
        });
    </script>
</body>
</html>